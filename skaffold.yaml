apiVersion: skaffold/v3
kind: Config
build:
  #platforms: ["linux/amd64"]
  artifacts:
    - image: rminz/skaffold-test
      docker:
        dockerfile: Dockerfile
  tagPolicy:
    gitCommit:
      variant: AbbrevCommitSha
      ignoreChanges: true
  local:
    concurrency: 2
    push: true
deploy:
  helm:
    releases:
      - name: app
        setValueTemplates:
          image.repository: '{{.IMAGE_REPO}}'
          image.tag: '{{.IMAGE_TAG}}'
        chartPath: ci/charts/web
        valuesFiles:
          - ci/deployment-values/common.yaml
          - ci/deployment-values/stage.yaml
